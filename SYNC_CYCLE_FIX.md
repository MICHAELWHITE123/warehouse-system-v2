# üîÑ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

## üö® –ü—Ä–æ–±–ª–µ–º–∞

–í –ª–æ–≥–∞—Ö –±—ã–ª–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–º–∏ —Ü–∏–∫–ª–∞–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:

```
[Log] Restarting sync...
[Log] Auto sync stopped
[Log] All flags and timeouts reset, mode: "hybrid" "forced:" false
[Log] Forcing local mode permanently...
[Log] Auto sync stopped
[Log] Attempting to switch back to hybrid mode...
[Log] Restarting sync...
```

–°–∏—Å—Ç–µ–º–∞ –∑–∞—Å—Ç—Ä–µ–≤–∞–ª–∞ –≤ —Ü–∏–∫–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏ –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞–ª–∞—Å—å –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏.

## üîç –ü—Ä–∏—á–∏–Ω—ã

1. **–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏** - –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞ `isInitialized`
2. **–ü–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ AutoSync** - –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å –Ω–∞–ª–∏—á–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–≥–æ `syncInterval`
3. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏** - –æ—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏
4. **–ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã –≤ –ª–æ–≥–∏–∫–µ** - —Ä–∞–∑–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤—ã–∑—ã–≤–∞–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞ –±–µ–∑ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–∏

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏

**–î–æ:**
```typescript
this.initializationTimeout = setTimeout(async () => {
  try {
    this.isInitialized = true;
    await this.performInitialSync();
  } catch (error) {
    // ...
  }
}, 1000);
```

**–ü–æ—Å–ª–µ:**
```typescript
this.initializationTimeout = setTimeout(async () => {
  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –±—ã–ª–∞ –ª–∏ —É–∂–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    if (this.isInitialized) {
      console.log('üîÑ Sync already initialized, skipping...');
      return;
    }
    
    this.isInitialized = true;
    console.log('üîÑ Performing initial sync...');
    
    // –í—ã–ø–æ–ª–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑
    await this.performInitialSync();
    
  } catch (error) {
    console.error('‚ùå Initial sync failed:', error);
    this.syncMode = 'local';
  }
}, 2000); // –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –¥–æ 2 —Å–µ–∫—É–Ω–¥
```

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ startAutoSync

**–î–æ:**
```typescript
startAutoSync(intervalMs: number = 30000): void {
  if (this.syncInterval) {
    clearInterval(this.syncInterval);
  }
  // ...
}
```

**–ü–æ—Å–ª–µ:**
```typescript
startAutoSync(intervalMs: number = 30000): void {
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞ –ª–∏ —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
  if (this.syncInterval) {
    console.log('‚ö†Ô∏è Auto sync already running, skipping...');
    return;
  }

  console.log(`üöÄ Starting auto sync with interval: ${intervalMs}ms`);
  // ...
}
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ restartSync

**–î–æ:**
```typescript
restartSync(): void {
  console.log('Restarting sync...');
  this.stopAutoSync();
  this.resetAllFlags();
  this.startAutoSync();
}
```

**–ü–æ—Å–ª–µ:**
```typescript
restartSync(): void {
  console.log('üîÑ Restarting sync...');
  
  // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
  this.stopAutoSync();
  
  // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–ª–∞–≥–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
  setTimeout(() => {
    this.lastSyncAttempt = 0;
    this.syncRetryDelay = 5000;
    this.lastOperationAdd = 0;
    this.lastStatusUpdate = 0;
    
    console.log(`‚úÖ Sync restarted in ${this.syncMode} mode`);
    
    // –ó–∞–ø—É—Å–∫–∞–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π
    this.startAutoSync();
  }, 1000);
}
```

## üîß –ö–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–ª–∞–≥–∞ `isInitialized` –ø–µ—Ä–µ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–µ–π
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–æ 2 —Å–µ–∫—É–Ω–¥

### 2. –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤ AutoSync
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –∞–∫—Ç–∏–≤–Ω–æ–≥–æ `syncInterval`
- ‚úÖ –í–æ–∑–≤—Ä–∞—Ç –∏–∑ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π

### 3. –ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∏
- ‚úÖ –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –æ—Å—Ç–∞–Ω–æ–≤–∫–æ–π –∏ –∑–∞–ø—É—Å–∫–æ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- ‚úÖ –°–±—Ä–æ—Å —Ñ–ª–∞–≥–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

### 4. –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –∫–∞—Å–∫–∞–¥–Ω—ã—Ö –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–º–µ—Å—Ç–æ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π
- ‚úÖ Graceful degradation –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `test-sync-cycle.html` –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ü–∏–∫–ª–æ–≤:

```bash
# –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
open test-sync-cycle.html
```

–¢–µ—Å—Ç –≤–∫–ª—é—á–∞–µ—Ç:
- ‚úÖ –°–∏–º—É–ª—è—Ü–∏—é –±—ã—Å—Ç—Ä—ã—Ö –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å—á–µ—Ç—á–∏–∫–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ü–∏–∫–ª–æ–≤

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤: 10+
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π: 5+
–ó–∞–ø—É—Å–∫–æ–≤ AutoSync: 8+
–û—à–∏–±–æ–∫: 3+
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
–ü–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤: 1-2
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π: 1
–ó–∞–ø—É—Å–∫–æ–≤ AutoSync: 1-2
–û—à–∏–±–æ–∫: 0
```

## üìù –õ–æ–≥–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

–û–∂–∏–¥–∞–µ–º—ã–µ –ª–æ–≥–∏ –¥–æ–ª–∂–Ω—ã –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```
[12:48:26] üîÑ Performing initial sync...
[12:48:26] üöÄ Starting auto sync with interval: 30000ms
[12:48:26] ‚úÖ Auto sync started successfully
[12:48:27] üîÑ Auto sync: processing 0 operations
[12:48:57] ‚ö†Ô∏è Auto sync already running, skipping...
```

–í–º–µ—Å—Ç–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤:
```
‚ùå Restarting sync...
‚ùå Auto sync stopped
‚ùå Restarting sync...
‚ùå Auto sync stopped
```

## üöÄ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ

1. **–ü–µ—Ä–µ—Å–æ–±–µ—Ä–∏—Ç–µ –ø—Ä–æ–µ–∫—Ç:**
   ```bash
   npm run build
   ```

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –ª–æ–∫–∞–ª—å–Ω–æ:**
   ```bash
   npm run dev
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞** - –Ω–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å —Ü–∏–∫–ª–æ–≤

4. **–ó–∞–¥–µ–ø–ª–æ–π—Ç–µ –Ω–∞ Vercel:**
   ```bash
   git add .
   git commit -m "üîÑ Fix sync cycles"
   git push
   ```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

- **–ù–µ —É–¥–∞–ª—è–π—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏** - –æ–Ω–∏ –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Ü–∏–∫–ª–æ–≤
- **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ª–æ–≥–∏** –≤ production –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–æ–æ–±—â–µ–Ω–∏–π
- **–ü—Ä–∏ –ø–æ—è–≤–ª–µ–Ω–∏–∏ —Ü–∏–∫–ª–æ–≤** —É–≤–µ–ª–∏—á—å—Ç–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ `setTimeout`
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ–≤—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

## üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Å —Ü–∏–∫–ª–∞–º–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ä–µ—à–µ–Ω–∞**
‚úÖ **–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–±–∏–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–æ–≤**
‚úÖ **–õ–æ–≥–∏ —á–∏—Å—Ç—ã–µ –∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–µ**
‚úÖ **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —É–ª—É—á—à–µ–Ω–∞**
