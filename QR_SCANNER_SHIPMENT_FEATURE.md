# QR Сканер для Отгрузок - Новая Функциональность

## Описание

Реализована новая функциональность для автоматической отметки оборудования как погруженного при сканировании QR кодов в отгрузках. Система автоматически определяет, какое оборудование принадлежит отгрузке, и отмечает его как погруженное с указанием пользователя, выполнившего сканирование.

## Основные Возможности

### 1. Автоматическое Определение Оборудования
- При сканировании QR кода система автоматически проверяет, принадлежит ли оборудование текущей отгрузке
- Поддерживается как отдельное оборудование, так и оборудование в составе стеков
- Автоматическое переключение между режимами сканирования (общее/отгрузка)

### 2. Отметка Погрузки
- Автоматическая отметка оборудования как погруженного при успешном сканировании
- Возможность отмены отметки (повторное сканирование)
- Поддержка как отдельных единиц оборудования, так и стеков

### 3. Отслеживание Пользователей
- Запись информации о том, кто отметил оборудование как погруженное
- Сохранение временной метки операции
- Отображение истории погрузки для каждого элемента

### 4. Сохранение Данных
- Автоматическое сохранение состояния погрузки в localStorage
- Сохранение истории операций между сессиями
- Синхронизация данных между компонентами

## Как Использовать

### Открытие QR Сканера

#### Вариант 1: Из списка отгрузок
1. В списке отгрузок найдите нужную отгрузку
2. Нажмите кнопку "QR" в строке отгрузки
3. Откроется QR сканер, настроенный на данную отгрузку

#### Вариант 2: Из детального просмотра
1. Откройте детальный просмотр отгрузки (кнопка "Просмотр")
2. В разделе "Оборудование" нажмите кнопку "Сканировать QR"
3. Откроется QR сканер для данной отгрузки

### Процесс Сканирования

1. **Подготовка**: Убедитесь, что QR сканер открыт в режиме отгрузки
2. **Сканирование**: Наведите камеру на QR код оборудования
3. **Автоматическая проверка**: Система проверит, принадлежит ли оборудование отгрузке
4. **Отметка**: При успешном сканировании оборудование автоматически отметится как погруженное
5. **Уведомление**: Появится сообщение об успешной отметке с указанием пользователя

### Отображение Результатов

- **В списке отгрузок**: Показывается количество погруженных позиций
- **В детальном просмотре**: Каждый элемент отображает информацию о том, кто и когда отметил его как погруженный
- **История**: Сохраняется полная история операций с временными метками

## Технические Детали

### Компоненты

- `QRScanner.tsx` - Основной компонент сканера с поддержкой отгрузок
- `ShipmentDetailsModal.tsx` - Модальное окно с кнопкой QR сканера
- `ShipmentList.tsx` - Список отгрузок с кнопками QR

### Состояние

- `scanMode` - Режим сканирования ("equipment" или "shipment")
- `loadingHistory` - История погрузки с информацией о пользователях
- `loadedEquipment` / `loadedStacks` - Текущее состояние погрузки

### Хранение Данных

- Состояние погрузки: `loadedEquipmentByShipment` и `loadedStacksByShipment`
- История операций: `loadingHistory_${shipmentId}` в localStorage
- Автоматическая синхронизация между компонентами

## Преимущества

1. **Автоматизация**: Не требуется ручной поиск и отметка оборудования
2. **Точность**: Исключаются ошибки при отметке неправильного оборудования
3. **Отслеживание**: Полная история операций с указанием ответственных лиц
4. **Удобство**: Быстрый доступ к QR сканеру из разных мест интерфейса
5. **Надежность**: Автоматическое сохранение данных и синхронизация

## Ограничения

- Требуется наличие QR кодов на оборудовании
- Необходим доступ к камере устройства
- Работает только с оборудованием, добавленным в отгрузку

## Будущие Улучшения

- Экспорт истории погрузки в PDF
- Уведомления о завершении погрузки
- Интеграция с системой аудита
- Поддержка пакетного сканирования
- Аналитика эффективности погрузки
