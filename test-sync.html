<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ - WeareHouse</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .status.online { background-color: #d4edda; border-color: #28a745; }
        .status.offline { background-color: #f8d7da; border-color: #dc3545; }
        .status.syncing { background-color: #d1ecf1; border-color: #17a2b8; }
        .form-group {
            margin: 15px 0;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 15px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }
        .tab.active {
            border-bottom-color: #007bff;
            color: #007bff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .device-info {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .sync-queue {
            background-color: #fff3cd;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîÑ –¢–µ—Å—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ WeareHouse</h1>
        
        <!-- –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è -->
        <div class="status" id="connectionStatus">
            <strong>–°—Ç–∞—Ç—É—Å:</strong> <span id="statusText">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∏ -->
        <div class="tabs">
            <div class="tab active" onclick="showTab('sync')">–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</div>
            <div class="tab" onclick="showTab('test')">–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
            <div class="tab" onclick="showTab('logs')">–õ–æ–≥–∏</div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ -->
        <div id="sync" class="tab-content active">
            <h2>üìä –°—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h2>
            
            <div class="device-info">
                <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ</h3>
                <p><strong>ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞:</strong> <span id="deviceId">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                <p><strong>–†–µ–∂–∏–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:</strong> <span id="syncMode">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                <p><strong>–°—Ç–∞—Ç—É—Å —Å–µ—Ç–∏:</strong> <span id="networkStatus">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
                <p><strong>–ü–æ—Å–ª–µ–¥–Ω—è—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è:</strong> <span id="lastSync">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
            </div>
            
            <div class="sync-queue">
                <h3>–û—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h3>
                <p><strong>–û–∂–∏–¥–∞—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:</strong> <span id="pendingOps">0</span></p>
                <p><strong>–£—Å–ø–µ—à–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:</strong> <span id="syncedOps">0</span></p>
                <p><strong>–ù–µ—É–¥–∞—á–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:</strong> <span id="failedOps">0</span></p>
            </div>
            
            <div class="form-group">
                <button onclick="forceSync()" id="syncBtn">üîÑ –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è</button>
                <button onclick="restartSync()">üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å</button>
                <button onclick="clearQueue()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –æ—á–µ—Ä–µ–¥—å</button>
            </div>
            
            <div class="form-group">
                <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞–º–∏</h3>
                <button onclick="setLocalMode()">üíæ –õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</button>
                <button onclick="setHybridMode()">üîÑ –ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º</button>
                <button onclick="setServerMode()">üåê –°–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º</button>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div id="test" class="tab-content">
            <h2>üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h2>
            
            <div class="form-group">
                <label for="testData">–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ:</label>
                <textarea id="testData" rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏..."></textarea>
            </div>
            
            <div class="form-group">
                <button onclick="addTestOperation()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</button>
                <button onclick="simulateConflict()">‚ö†Ô∏è –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç</button>
                <button onclick="testLocalStorage()">üíæ –¢–µ—Å—Ç localStorage</button>
            </div>
            
            <div class="form-group">
                <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è</h3>
                <div id="testResults" class="log"></div>
            </div>
        </div>
        
        <!-- –í–∫–ª–∞–¥–∫–∞ –ª–æ–≥–æ–≤ -->
        <div id="logs" class="tab-content">
            <h2>üìù –õ–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏</h2>
            
            <div class="form-group">
                <button onclick="clearLogs()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥–∏</button>
                <button onclick="exportLogs()">üì• –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤</button>
            </div>
            
            <div id="logsContainer" class="log"></div>
        </div>
    </div>

    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let deviceId = 'test_device_' + Date.now();
        let syncMode = 'hybrid';
        let isOnline = navigator.onLine;
        let lastSync = Date.now();
        let syncQueue = [];
        let logs = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            initializeSync();
            updateUI();
            startLogging();
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–µ—Ç–∏
            window.addEventListener('online', () => {
                isOnline = true;
                updateUI();
                log('üåê –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ');
            });
            
            window.addEventListener('offline', () => {
                isOnline = false;
                updateUI();
                log('üåê –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–æ—Ç–µ—Ä—è–Ω–æ');
            });
            
            // –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ localStorage
            window.addEventListener('storage', (event) => {
                if (event.key && event.key.startsWith('warehouse-sync-')) {
                    log('üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤ localStorage: ' + event.key);
                    handleStorageChange(event);
                }
            });
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        function initializeSync() {
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ
            loadFromLocalStorage();
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
            const existingId = localStorage.getItem('warehouse-device-id');
            if (existingId) {
                deviceId = existingId;
            } else {
                localStorage.setItem('warehouse-device-id', deviceId);
            }
            
            log('üöÄ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞: ' + deviceId);
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI
        function updateUI() {
            // –°—Ç–∞—Ç—É—Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
            const statusEl = document.getElementById('connectionStatus');
            const statusTextEl = document.getElementById('statusText');
            
            if (isOnline) {
                statusEl.className = 'status online';
                statusTextEl.textContent = '–û–Ω–ª–∞–π–Ω';
            } else {
                statusEl.className = 'status offline';
                statusTextEl.textContent = '–û—Ñ–ª–∞–π–Ω';
            }
            
            // –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ
            document.getElementById('deviceId').textContent = deviceId;
            document.getElementById('syncMode').textContent = syncMode;
            document.getElementById('networkStatus').textContent = isOnline ? '–û–Ω–ª–∞–π–Ω' : '–û—Ñ–ª–∞–π–Ω';
            document.getElementById('lastSync').textContent = new Date(lastSync).toLocaleString();
            
            // –û—á–µ—Ä–µ–¥—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            const pending = syncQueue.filter(op => op.status === 'pending').length;
            const synced = syncQueue.filter(op => op.status === 'synced').length;
            const failed = syncQueue.filter(op => op.status === 'failed').length;
            
            document.getElementById('pendingOps').textContent = pending;
            document.getElementById('syncedOps').textContent = synced;
            document.getElementById('failedOps').textContent = failed;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
            const syncBtn = document.getElementById('syncBtn');
            syncBtn.disabled = pending === 0;
        }
        
        // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logs.push(logEntry);
            
            // –û–±–Ω–æ–≤–ª—è–µ–º UI –ª–æ–≥–æ–≤
            const logsContainer = document.getElementById('logsContainer');
            if (logsContainer) {
                logsContainer.innerHTML = logs.map(log => `<div>${log}</div>`).join('');
                logsContainer.scrollTop = logsContainer.scrollHeight;
            }
            
            // –í—ã–≤–æ–¥–∏–º –≤ –∫–æ–Ω—Å–æ–ª—å
            console.log(logEntry);
        }
        
        // –ó–∞–ø—É—Å–∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        function startLogging() {
            setInterval(() => {
                if (syncQueue.length > 0) {
                    const pending = syncQueue.filter(op => op.status === 'pending').length;
                    if (pending > 0) {
                        log(`üìä –í –æ—á–µ—Ä–µ–¥–∏ ${pending} –æ–ø–µ—Ä–∞—Ü–∏–π`);
                    }
                }
            }, 10000); // –ö–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ localStorage
        function loadFromLocalStorage() {
            try {
                const stored = localStorage.getItem('warehouse-sync-queue');
                if (stored) {
                    syncQueue = JSON.parse(stored);
                    log(`üì• –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${syncQueue.length} –æ–ø–µ—Ä–∞—Ü–∏–π –∏–∑ localStorage`);
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ localStorage: ' + error.message);
                syncQueue = [];
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage
        function saveToLocalStorage() {
            try {
                localStorage.setItem('warehouse-sync-queue', JSON.stringify(syncQueue));
                localStorage.setItem('warehouse-sync-updated', Date.now().toString());
                log('üíæ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ localStorage');
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ localStorage: ' + error.message);
            }
        }
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ localStorage
        function handleStorageChange(event) {
            try {
                if (event.newValue) {
                    const newData = JSON.parse(event.newValue);
                    if (Array.isArray(newData)) {
                        // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
                        newData.forEach(op => {
                            if (op.deviceId !== deviceId && !syncQueue.find(existing => existing.id === op.id)) {
                                syncQueue.push(op);
                                log(`üì• –ü–æ–ª—É—á–µ–Ω–∞ –Ω–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ ${op.deviceId}`);
                            }
                        });
                        
                        saveToLocalStorage();
                        updateUI();
                    }
                }
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è localStorage: ' + error.message);
            }
        }
        
        // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
        function forceSync() {
            log('üîÑ –ó–∞–ø—É—Å–∫ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...');
            
            const pendingOps = syncQueue.filter(op => op.status === 'pending');
            if (pendingOps.length === 0) {
                log('‚ÑπÔ∏è –ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏');
                return;
            }
            
            // –ò–º–∏—Ç–∏—Ä—É–µ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é
            pendingOps.forEach(op => {
                op.status = 'synced';
                op.syncedAt = Date.now();
            });
            
            lastSync = Date.now();
            saveToLocalStorage();
            updateUI();
            
            log(`‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ ${pendingOps.length} –æ–ø–µ—Ä–∞—Ü–∏–π`);
        }
        
        // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
        function restartSync() {
            log('üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–∏—Å—Ç–µ–º—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...');
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
            syncQueue.forEach(op => {
                if (op.status === 'failed') {
                    op.status = 'pending';
                    op.retryCount = 0;
                }
            });
            
            lastSync = Date.now();
            saveToLocalStorage();
            updateUI();
            
            log('‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∞');
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏
        function clearQueue() {
            log('üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...');
            
            syncQueue = [];
            saveToLocalStorage();
            updateUI();
            
            log('‚úÖ –û—á–µ—Ä–µ–¥—å –æ—á–∏—â–µ–Ω–∞');
        }
        
        // –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–µ–∂–∏–º–æ–≤
        function setLocalMode() {
            syncMode = 'local';
            log('üíæ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º');
            updateUI();
        }
        
        function setHybridMode() {
            syncMode = 'hybrid';
            log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –≥–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º');
            updateUI();
        }
        
        function setServerMode() {
            syncMode = 'server';
            log('üåê –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ —Å–µ—Ä–≤–µ—Ä–Ω—ã–π —Ä–µ–∂–∏–º');
            updateUI();
        }
        
        // –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
        function addTestOperation() {
            const testData = document.getElementById('testData').value || '–¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ ' + Date.now();
            
            const operation = {
                id: 'op_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                table: 'test_table',
                operation: 'create',
                data: { content: testData, timestamp: Date.now() },
                timestamp: Date.now(),
                deviceId: deviceId,
                status: 'pending',
                retryCount: 0
            };
            
            syncQueue.push(operation);
            saveToLocalStorage();
            updateUI();
            
            log(`‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è: ${operation.id}`);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const results = document.getElementById('testResults');
            results.innerHTML += `<div>[${new Date().toLocaleTimeString()}] –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–ø–µ—Ä–∞—Ü–∏—è: ${operation.id}</div>`;
        }
        
        function simulateConflict() {
            log('‚ö†Ô∏è –°–∏–º—É–ª—è—Ü–∏—è –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏...');
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—â–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
            const conflictOp1 = {
                id: 'conflict_1_' + Date.now(),
                table: 'test_table',
                operation: 'update',
                data: { id: 'test_id', content: '–í–µ—Ä—Å–∏—è 1', timestamp: Date.now() },
                timestamp: Date.now(),
                deviceId: deviceId,
                status: 'pending',
                retryCount: 0
            };
            
            const conflictOp2 = {
                id: 'conflict_2_' + Date.now(),
                table: 'test_table',
                operation: 'update',
                data: { id: 'test_id', content: '–í–µ—Ä—Å–∏—è 2', timestamp: Date.now() + 1000 },
                timestamp: Date.now() + 1000,
                deviceId: 'other_device',
                status: 'pending',
                retryCount: 0
            };
            
            syncQueue.push(conflictOp1, conflictOp2);
            saveToLocalStorage();
            updateUI();
            
            log('‚ö†Ô∏è –°–æ–∑–¥–∞–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É –æ–ø–µ—Ä–∞—Ü–∏—è–º–∏');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
            const results = document.getElementById('testResults');
            results.innerHTML += `<div>[${new Date().toLocaleTimeString()}] –°–æ–∑–¥–∞–Ω –∫–æ–Ω—Ñ–ª–∏–∫—Ç: ${conflictOp1.id} vs ${conflictOp2.id}</div>`;
        }
        
        function testLocalStorage() {
            log('üíæ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ localStorage...');
            
            try {
                // –¢–µ—Å—Ç –∑–∞–ø–∏—Å–∏
                const testData = { test: 'data', timestamp: Date.now() };
                localStorage.setItem('warehouse-test', JSON.stringify(testData));
                
                // –¢–µ—Å—Ç —á—Ç–µ–Ω–∏—è
                const readData = JSON.parse(localStorage.getItem('warehouse-test'));
                
                if (readData.test === testData.test) {
                    log('‚úÖ localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                } else {
                    log('‚ùå localStorage —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ');
                }
                
                // –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
                localStorage.removeItem('warehouse-test');
                
            } catch (error) {
                log('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è localStorage: ' + error.message);
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∞–º–∏
        function showTab(tabName) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }
        
        // –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
        function clearLogs() {
            logs = [];
            document.getElementById('logsContainer').innerHTML = '';
            log('üóëÔ∏è –õ–æ–≥–∏ –æ—á–∏—â–µ–Ω—ã');
        }
        
        // –≠–∫—Å–ø–æ—Ä—Ç –ª–æ–≥–æ–≤
        function exportLogs() {
            const logText = logs.join('\n');
            const blob = new Blob([logText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'sync-logs-' + new Date().toISOString().slice(0, 19) + '.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            log('üì• –õ–æ–≥–∏ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã');
        }
        
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–∂–¥—ã–µ 5 —Å–µ–∫—É–Ω–¥
        setInterval(updateUI, 5000);
    </script>
</body>
</html>
