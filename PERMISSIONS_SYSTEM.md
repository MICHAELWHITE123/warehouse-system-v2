# Система прав доступа для WeareHouse

## Обзор

Система прав доступа в WeareHouse предоставляет детальный контроль над тем, что может делать каждый пользователь в системе. Это обеспечивает безопасность и позволяет настраивать права в соответствии с должностными обязанностями сотрудников.

## Роли пользователей

### 1. Администратор (admin)
- **Полный доступ** ко всем функциям системы
- Может управлять пользователями и их правами
- Доступ к системным настройкам и журналам аудита
- Может экспортировать данные и выполнять массовые операции

### 2. Менеджер (manager)
- **Расширенный доступ** к основным функциям
- Может создавать, редактировать, но не удалять записи
- Доступ к статистике и журналам аудита
- Может утверждать отгрузки и экспортировать данные

### 3. Оператор (operator)
- **Ограниченный доступ** для повседневных операций
- Может просматривать все данные
- Может создавать отгрузки
- Доступ к QR-сканированию

### 4. Просмотрщик (viewer)
- **Только просмотр** данных
- Не может создавать, редактировать или удалять записи
- Ограниченный доступ к функциям

## Структура прав доступа

### Оборудование (equipment)
- `view` - Просмотр оборудования
- `create` - Создание нового оборудования
- `edit` - Редактирование оборудования
- `delete` - Удаление оборудования
- `export` - Экспорт данных об оборудовании

### Стеки (stacks)
- `view` - Просмотр стеков
- `create` - Создание новых стеков
- `edit` - Редактирование стеков
- `delete` - Удаление стеков

### Отгрузки (shipments)
- `view` - Просмотр отгрузок
- `create` - Создание отгрузок
- `edit` - Редактирование отгрузок
- `delete` - Удаление отгрузок
- `approve` - Утверждение отгрузок
- `export` - Экспорт отгрузок

### Категории (categories)
- `view` - Просмотр категорий
- `create` - Создание категорий
- `edit` - Редактирование категорий
- `delete` - Удаление категорий

### Местоположения (locations)
- `view` - Просмотр местоположений
- `create` - Создание местоположений
- `edit` - Редактирование местоположений
- `delete` - Удаление местоположений

### Администрирование (admin)
- `userManagement` - Управление пользователями
- `systemSettings` - Настройки системы
- `auditLogs` - Доступ к журналам аудита
- `statistics` - Доступ к статистике

### Дополнительные функции (additional)
- `qrScanning` - QR-сканирование
- `pdfExport` - Экспорт в PDF
- `bulkOperations` - Массовые операции
- `dataImport` - Импорт данных

## Использование в компонентах

### Хук usePermissions

```typescript
import { usePermissions } from '../hooks/usePermissions';

function MyComponent() {
  const { can, isAdmin, isManager } = usePermissions();

  // Проверка конкретного права
  if (can('equipment', 'create')) {
    // Показать кнопку создания оборудования
  }

  // Проверка роли
  if (isAdmin()) {
    // Показать административные функции
  }

  return (
    <div>
      {/* Компонент */}
    </div>
  );
}
```

### Компоненты-обертки

```typescript
import { CanView, CanCreate, IsAdmin } from '../ui/PermissionGate';

function MyComponent() {
  return (
    <div>
      {/* Всегда видимо */}
      <h1>Заголовок</h1>

      {/* Видимо только при наличии прав на просмотр */}
      <CanView>
        <div>Контент для просмотра</div>
      </CanView>

      {/* Видимо только при наличии прав на создание */}
      <CanCreate>
        <button>Создать</button>
      </CanCreate>

      {/* Видимо только администраторам */}
      <IsAdmin>
        <button>Админ функция</button>
      </IsAdmin>
    </div>
  );
}
```

## Управление правами в админ панели

### Создание пользователя
1. Перейдите в раздел "Управление пользователями"
2. Нажмите "Создать пользователя"
3. Выберите роль - права будут назначены автоматически
4. Заполните остальные поля и создайте пользователя

### Редактирование прав
1. В таблице пользователей нажмите на иконку щита (Shield)
2. В открывшемся диалоге настройте детальные права
3. Используйте кнопки "Все включить"/"Все выключить" для быстрой настройки
4. Нажмите "Сбросить к умолчанию" для возврата к стандартным правам роли

### Просмотр сводки прав
1. В диалоге управления правами перейдите на вкладку "Сводка прав"
2. Просмотрите статистику по разделам
3. Убедитесь, что права настроены корректно

## Лучшие практики

### 1. Принцип минимальных привилегий
- Назначайте пользователям только те права, которые им действительно нужны
- Регулярно пересматривайте права доступа

### 2. Группировка по ролям
- Используйте предустановленные роли как основу
- Настраивайте индивидуальные права только при необходимости

### 3. Аудит и мониторинг
- Регулярно проверяйте журналы доступа
- Отслеживайте изменения в правах пользователей

### 4. Тестирование
- Проверяйте работу системы с разными ролями
- Убедитесь, что ограничения работают корректно

## Безопасность

### Защита от несанкционированного доступа
- Все проверки прав выполняются на клиенте и сервере
- Права пользователя проверяются при каждом действии
- Нет возможности обойти ограничения через манипуляции с интерфейсом

### Шифрование и хранение
- Пароли пользователей хешируются
- Права доступа хранятся в зашифрованном виде
- Сессии пользователей защищены

## Устранение неполадок

### Пользователь не может выполнить действие
1. Проверьте роль пользователя
2. Убедитесь, что у пользователя есть необходимые права
3. Проверьте, не отключен ли пользователь

### Права не применяются
1. Обновите страницу
2. Проверьте, что изменения сохранены
3. Убедитесь, что пользователь перелогинился

### Ошибки в интерфейсе
1. Проверьте консоль браузера на ошибки
2. Убедитесь, что все компоненты правильно импортированы
3. Проверьте совместимость версий

## Расширение системы

### Добавление новых прав
1. Обновите интерфейс `UserPermissions`
2. Добавьте новые права в `DEFAULT_PERMISSIONS`
3. Обновите компонент `PermissionsManager`
4. Добавьте проверки в соответствующие компоненты

### Добавление новых ролей
1. Расширьте тип `UserRole`
2. Добавьте права по умолчанию для новой роли
3. Обновите интерфейс выбора ролей
4. Добавьте соответствующие проверки

## Поддержка

При возникновении вопросов или проблем с системой прав доступа:
1. Проверьте данную документацию
2. Обратитесь к администратору системы
3. Проверьте журналы системы на наличие ошибок
